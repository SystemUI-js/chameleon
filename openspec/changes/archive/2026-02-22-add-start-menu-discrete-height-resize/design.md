## Context

当前代码库有 `StartButton` 与 `Taskbar`，但尚未形成可调整高度的开始菜单面板。现有 `Window` 组件已具备成熟的拖动/缩放交互（含边界、方向与回调），并且 Win98/WinXP 主题体系已能承载行为差异。该变更要求在保持复古桌面交互风格的前提下，仅支持两个离散高度档位（`1x`、`2x`），避免自由尺寸带来的状态复杂度与视觉不一致。

约束：
- 仅 Win98/WinXP 开始菜单支持该能力。
- 仅支持垂直高度变化，且最终高度只能落在 `1x` 或 `2x`。
- 不引入新外部依赖，复用现有组件与主题能力。

## Goals / Non-Goals

**Goals:**
- 提供可拖动的开始菜单高度切换交互，且结果严格吸附到 `1x/2x`。
- 拖动过程中与拖动结束时行为一致：可预览、可吸附、可回退到合法档位。
- 在 Win98 与 WinXP 中共享同一行为契约，视觉由主题层控制。
- 为后续任务拆解提供清晰的组件职责、状态模型与测试边界。

**Non-Goals:**
- 不支持自由像素级缩放、不支持 3 档及以上高度。
- 不改造通用 `Window` 为任意“步进缩放引擎”。
- 不扩展到非开始菜单场景（普通窗口、下拉菜单等）。

## Decisions

1. **以“开始菜单专用状态机”实现离散高度，而不是直接暴露自由高度值**
   - 方案：将高度状态建模为 `"1x" | "2x"`，并维护对应像素映射（由主题或常量提供）。
   - 原因：需求本质是离散语义而非连续尺寸，离散状态更易测、易回放、易持久化。
   - 备选：直接维护 `number` 像素高度并在结束时 round；该方案在拖动中会出现中间非法值，增加一致性风险。

2. **仅允许底边拖动触发档位切换**
   - 方案：交互句柄限定在底边区域，水平方向与上边缘不参与调整。
   - 原因：符合任务定义（改变“高度”），并降低与菜单定位逻辑的耦合。
   - 备选：复用 8 方向句柄；会引入宽度和位置变更，不符合当前目标。

3. **采用“阈值吸附”策略确定目标档位**
   - 方案：在拖动时根据当前指针位移计算目标高度，并按阈值切换到最近合法档位（`1x` 或 `2x`）。
   - 原因：用户可通过拖动获得即时反馈，且最终状态稳定可预测。
   - 备选：仅在 `pointerup` 时吸附；实现简单，但拖动过程反馈不足。

4. **复用现有交互基础设施，避免新增依赖**
   - 方案：复用当前指针事件处理模式与主题行为配置方式，在开始菜单实现中引入最小增量。
   - 原因：减少学习与维护成本，保持代码风格一致。
   - 备选：引入第三方 resize 库；对本需求收益有限且增加包体与适配成本。

5. **测试以“语义断言”为主，不以中间像素为主**
   - 方案：重点断言拖动后档位结果（`1x/2x`）与行为边界，而非连续过程中的每个像素变化。
   - 原因：需求关心离散结果，语义断言更稳健、抗样式波动。
   - 备选：全量像素轨迹断言；脆弱且维护成本高。

## Risks / Trade-offs

- **[风险] 阈值选择不当导致“误切档”** → **Mitigation**: 采用居中阈值并在测试中覆盖临界值上下边界。
- **[风险] 主题高度映射不一致导致视觉跳变** → **Mitigation**: 在主题层定义统一档位映射契约，并为 Win98/WinXP 分别校验。
- **[风险] 与菜单定位（bottom/top mount）联动时出现位移抖动** → **Mitigation**: 高度切换仅改变面板高度，不改变锚点基准，回归测试覆盖展开/收起与切档。
- **[权衡] 不支持自由尺寸牺牲灵活性** → **Mitigation**: 用明确范围换取一致体验与更低复杂度；若后续有需求再扩展档位模型。

## Migration Plan

1. 先引入开始菜单高度档位模型（`1x/2x`）与像素映射。
2. 增加底边拖动句柄与阈值吸附逻辑。
3. 接入 Win98/WinXP 主题行为配置并验证样式表现。
4. 增加测试：基础切档、临界阈值、越界拖动、主题一致性。
5. 若出现问题，可回滚为固定 `1x` 高度（保留菜单基础功能，不保留拖动能力）。

## Open Questions

- `1x` 与 `2x` 的像素基线是否由主题 token 明确定义，还是由菜单内容高度推导？
- 拖动过程是否需要显示“当前目标档位”视觉提示（例如阴影或标记线）？
- 高度档位是否需要跨会话持久化（当前建议先不做）？
